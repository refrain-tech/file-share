<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Upload</title>
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-storage.js"></script>
  </head>
  <body>
    <div id="title">Upload</div>
    <input id="picker" type = "file" />
    <button id="upload">アップロード</button>
    <script src="firebase-init.js"></script>
    <script>
'use strict';
let SELECTED_FILE = null;
picker.addEventListener('change', ({target: {files}}) => SELECTED_FILE = files, false);
upload.addEventListener('click', () => {
  [].slice.call(SELECTED_FILE ?? []).forEach(file => {
    const {name} = file;
    const ref = storage.ref(`files/${name}`);
    ref.put(file).then(snapshot => ref.getDownloadURL().then(url => {
      database.ref('share').push({name, url});
      window.alert(`password: ${Date.now()}`);
    }));
  });
  SELECTED_FILE = null;
}, false);
    </script>
  </body>
</html>
